"use strict";exports.id=3461,exports.ids=[3461],exports.modules={93461:(e,r,n)=>{n.d(r,{ApolloServerPluginInlineTrace:()=>a});var l=n(91129),t=n(12874),i=n(32522),s=n(7639);function a(e=Object.create(null)){let r=!e.__onlyIfSchemaIsSubgraph||null;return(0,i.R)({__internal_plugin_id__:"InlineTrace",__is_disabled_plugin__:!1,async serverWillStart({schema:e,logger:n}){null===r&&(r=(0,s.e)(e))&&n.info("Enabling inline tracing for this subgraph. To disable, use ApolloServerPluginInlineTraceDisabled.")},async requestDidStart({request:{http:n},metrics:i}){if(!r)return;let s=new t.B({maskedBy:"ApolloServerPluginInlineTrace",sendErrors:e.includeErrors});if(n?.headers.get("apollo-federation-include-trace")==="ftv1"&&!1!==i.captureTraces)return i.captureTraces=!0,s.startTiming(),{executionDidStart:async()=>({willResolveField:({info:e})=>s.willResolveField(e)}),async didEncounterErrors({errors:e}){s.didEncounterErrors(e)},async willSendResponse({response:e}){if(s.stopTiming(),"incremental"===e.body.kind)return;i.queryPlanTrace&&(s.trace.queryPlan=i.queryPlanTrace);let r=l.Cn.encode(s.trace).finish(),n=Buffer.from(r,r.byteOffset,r.byteLength),t=e.body.singleResult.extensions||(e.body.singleResult.extensions=Object.create(null));if(void 0!==t.ftv1)throw Error("The `ftv1` extension was already present.");t.ftv1=n.toString("base64")}}}})}}};